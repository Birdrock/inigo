#!/bin/bash

set -e -x

export GOROOT=/usr/local/go
export GOPATH_ROOT=$PWD
export INIGO_GOPATH=${GOPATH_ROOT}/src/github.com/cloudfoundry-incubator/inigo/Godeps/_workspace
export GOPATH=${INIGO_GOPATH}:${GOPATH_ROOT}

export PATH=${INIGO_GOPATH}/bin:${GOPATH_ROOT}/bin:${GOROOT}/bin:${PATH}

# set up compile-time $GOPATHs for each component
export LOGGREGATOR_GOPATH=${GOPATH_ROOT}/loggregator
export ROUTER_GOPATH=${GOPATH_ROOT}:${GOPATH_ROOT}/src/github.com/cloudfoundry/gorouter/Godeps/_workspace
export AUCTIONEER_GOPATH=${GOPATH_ROOT}:${GOPATH_ROOT}/src/github.com/cloudfoundry-incubator/auctioneer/Godeps/_workspace
export CONVERGER_GOPATH=${GOPATH_ROOT}:${GOPATH_ROOT}/src/github.com/cloudfoundry-incubator/converger/Godeps/_workspace
export EXECUTOR_GOPATH=${GOPATH_ROOT}:${GOPATH_ROOT}/src/github.com/cloudfoundry-incubator/executor/Godeps/_workspace
export FILE_SERVER_GOPATH=${GOPATH_ROOT}:${GOPATH_ROOT}/src/github.com/cloudfoundry-incubator/file-server/Godeps/_workspace
export LINUX_CIRCUS_GOPATH=${GOPATH_ROOT}:${GOPATH_ROOT}/src/github.com/cloudfoundry-incubator/linux-circus/Godeps/_workspace
export DOCKER_CIRCUS_GOPATH=${GOPATH_ROOT}:${GOPATH_ROOT}/src/github.com/cloudfoundry-incubator/docker-circus/Godeps/_workspace
export NSYNC_GOPATH=${GOPATH_ROOT}:${GOPATH_ROOT}/src/github.com/cloudfoundry-incubator/nsync/Godeps/_workspace
export REP_GOPATH=${GOPATH_ROOT}:${GOPATH_ROOT}/src/github.com/cloudfoundry-incubator/rep/Godeps/_workspace
export ROUTE_EMITTER_GOPATH=${GOPATH_ROOT}:${GOPATH_ROOT}/src/github.com/cloudfoundry-incubator/route-emitter/Godeps/_workspace
export STAGER_GOPATH=${GOPATH_ROOT}:${GOPATH_ROOT}/src/github.com/cloudfoundry-incubator/stager/Godeps/_workspace
export TPS_GOPATH=${GOPATH_ROOT}:${GOPATH_ROOT}/src/github.com/cloudfoundry-incubator/tps/Godeps/_workspace
export WARDEN_LINUX_GOPATH=${GOPATH_ROOT}:${GOPATH_ROOT}/src/github.com/cloudfoundry-incubator/garden-linux/Godeps/_workspace

# install application dependencies
for package in github.com/coreos/etcd github.com/apcera/gnatsd; do
  go install $package
done

$(dirname $0)/drone-test "$@"
